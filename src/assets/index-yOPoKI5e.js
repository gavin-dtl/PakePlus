import{d as J,q as M,p as Q,r as u,b as A,e as B,c as w,o as r,f as m,j as t,C as k,v as P,s as i,x,H as G,aE as K,a as o,ap as O,F as W,i as X,t as F,Q as h,aS as Z,J as $,aT as aa,aU as ea,aR as la,_ as ta}from"./index-Cv_H95TD.js";import{U as sa,F as g}from"./UploadFile-BmfXmoQQ.js";const ia={class:"f1le-main"},na={class:"operate-button"},ra={class:"filePath"},oa=["onClick"],pa={style:{"background-color":"rgba(35,110,214,0.26)","border-radius":"4px",padding:"5px 10px","margin-left":"5px"}},ca={key:0},da={style:{"margin-top":"15px"}},ua={style:{"margin-left":"5px"}},ma=J({name:"FileManagement",__name:"index",emits:["success"],setup(va,{emit:ya}){const{t:U}=M(),s=Q(),p=(u({}),u([])),z=u([]),n=async e=>{const a=await g.commonFileList({path:e});p.value=a.filePath,z.value=a.fileList,c.value=p.value[p.value.length-1].path},V=async e=>{e.directory&&n(e.path)},R=async()=>{const e=await s.validatePrompt("\u8BF7\u8F93\u5165\u6587\u4EF6\u5939\u540D\u79F0",U("\u521B\u5EFA\u6587\u4EF6\u5939"),{inputValue:"",validator:d=>!!d||"\u6587\u4EF6\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}),a=p.value[p.value.length-1].path;await g.createDirectory({dirName:e.value,basePath:a}),n(a),s.success("\u65B0\u589E\u6210\u529F")},C=u(),c=u(""),T={title:"\u6587\u4EF6\u4E0A\u4F20",isShowTip:!1},Y=()=>{n(c.value)},_=u([]),E=e=>{_.value=e},I=async()=>{try{await s.delConfirm(),await Promise.all(_.value.map(e=>g.deleteFile({filePath:e.path}))),await n(c.value)}catch{}},b=u(!1),L=e=>{e.preventDefault(),b.value=!0},N=e=>{e.preventDefault(),b.value=!1},j=async e=>{e.preventDefault(),b.value=!1;const a=e.dataTransfer.files;if(a&&a.length!==0)if(a.length>1)s.error("\u5355\u6B21\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6");else if(a[0].size!==0||a[0].type!==""){s.success("\u6B63\u5728\u4E0A\u4F20\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019...");try{await g.uploadFile({file:a[0],dir:c.value}),s.success("\u6587\u4EF6\u4E0A\u4F20\u6210\u529F"),n(c.value)}catch{s.error("\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25")}}else s.error("\u6682\u4E0D\u652F\u6301\u4E0A\u4F20\u6587\u4EF6\u5939")};return A(()=>{n("")}),B(()=>{}),(e,a)=>{const d=G,f=Z,q=$,H=la;return r(),w("div",ia,[m("div",na,[t(d,{type:"primary",onClick:R},{default:i(()=>a[1]||(a[1]=[x("\u521B\u5EFA\u6587\u4EF6\u5939")])),_:1}),t(sa,K({style:{display:"inline-block","margin-left":"10px",transform:"translateY(4px)"},onUploadSuccess:Y},T,{dir:o(c),modelValue:o(C),"onUpdate:modelValue":a[0]||(a[0]=l=>O(C)?C.value=l:null),limit:1}),null,16,["dir","modelValue"]),o(_).length>0?(r(),k(d,{key:0,type:"danger",onClick:I,style:{"margin-left":"10px",transform:"translateY(2px)"}},{default:i(()=>a[2]||(a[2]=[x("\u6279\u91CF\u5220\u9664")])),_:1})):P("",!0)]),m("div",ra,[(r(!0),w(W,null,X(o(p),(l,D)=>(r(),w("p",{onClick:v=>{n(l.path)},key:l.path},[m("span",pa,F(l.name),1),o(p).length!=D+1?(r(),w("span",ca," > ")):P("",!0)],8,oa))),128))]),m("div",da,[m("div",{class:"file-drop-area",onDrop:h(j,["prevent"]),onDragover:h(L,["prevent"]),onDragleave:h(N,["prevent"])},[t(H,{data:o(z),height:"660px",style:{width:"100%"},onCellClick:V,onSelectionChange:E},{default:i(()=>[t(f,{type:"selection",width:"55"}),t(f,{prop:"name",label:"\u540D\u79F0"},{default:i(l=>[t(q,null,{default:i(()=>[l.row.directory?(r(),k(o(aa),{key:0})):(r(),k(o(ea),{key:1}))]),_:2},1024),m("span",ua,F(l.row.name),1)]),_:1}),t(f,{prop:"size",label:"\u5927\u5C0F",width:"250px",align:"center"}),t(f,{prop:"format",label:"\u7C7B\u578B",width:"250px",align:"center"},{default:i(l=>[m("span",null,F(l.row.directory?"\u6587\u4EF6\u5939":l.row.format),1)]),_:1}),t(f,{label:"\u64CD\u4F5C",align:"center",width:"250px"},{default:i(l=>[t(d,{size:"small",type:"danger",onClick:h(D=>(async v=>{await s.delConfirm("\u786E\u8BA4\u5220\u9664\u6587\u4EF6?"),await g.deleteFile({filePath:v.path}),n(c.value)})(l.row),["stop"])},{default:i(()=>a[3]||(a[3]=[x(" \u5220\u9664 ")])),_:2},1032,["onClick"]),l.row.directory?P("",!0):(r(),k(d,{key:0,size:"small",onClick:h(D=>(async v=>{try{const S="/api/core/file/download?filePath="+encodeURIComponent(v.path),y=document.createElement("a");y.href=S,y.download=v.playName,document.body.appendChild(y),y.click(),document.body.removeChild(y)}catch{}})(l.row),["stop"])},{default:i(()=>a[4]||(a[4]=[x(" \u4E0B\u8F7D ")])),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])],32)])])}}}),fa=ta(ma,[["__scopeId","data-v-c94872f2"]]);export{fa as default};
