import{_ as S,d as K,r as c,q as Q,p as X,u as Y,h as Z,a as e,a4 as E,as as $,a5 as ee,ae,C,o as m,s as t,j as a,a7 as le,a8 as te,a9 as se,v as _,aa as oe,c as q,t as F,a6 as ne,bV as re,an as ie,ao as de,bW as pe,ak as ce}from"./index-DwcZmOlQ.js";import{_ as ue}from"./XButton-BmXPhnym.js";import{_ as me}from"./ForgetPasswordForm.vue_vue_type_style_index_0_scoped_7bcea1b4_lang-Cq4GchJk.js";import{_ as ge}from"./Verify-BpDrlxTH.js";import{u as w}from"./useIcon-DYJaHBnu.js";import{u as fe,L,_ as he,a as _e}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-CkqoI9Xw.js";import{r as we}from"./formRules-RrpKDPWM.js";const ye=S(me,[["__scopeId","data-v-38c93dba"]]),be={key:1,class:"getMobileCode",style:{cursor:"pointer"}},xe=S(K({name:"ForgetPasswordForm",__name:"ForgetPasswordForm",setup(ve){const y=c(),{t:o}=Q(),g=X(),{currentRoute:T,push:ke}=Y(),b=c(),u=c(!1),I=w({icon:"ep:house"}),U=w({icon:"ep:cellphone"}),z=w({icon:"ep:circle-check"}),{validForm:R}=_e(b),{handleBackLogin:M,getLoginState:O,setLoginState:j}=fe(),W=Z(()=>e(O)===L.RESET_PASSWORD),A=c("blockPuzzle"),x=(i,l,n)=>{l===""?n(new Error("\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801")):l!==s.password?n(new Error("\u4E24\u6B21\u8F93\u5165\u5BC6\u7801\u4E0D\u4E00\u81F4!")):n()},B={tenantName:[{required:!0,min:2,max:20,trigger:"blur",message:"\u957F\u5EA6\u4E3A4\u523016\u4F4D"}],mobile:[{required:!0,min:11,max:11,trigger:"blur",message:"\u624B\u673A\u53F7\u957F\u5EA6\u4E3A11\u4F4D"}],password:[{required:!0,min:4,max:16,validator:x,trigger:"blur",message:"\u5BC6\u7801\u957F\u5EA6\u4E3A4\u523016\u4F4D"}],check_password:[{required:!0,validator:x,trigger:"blur"}],code:[we]},s=E({captchaEnable:"false",tenantEnable:"true",tenantName:"",username:"",password:"",check_password:"",mobile:"",code:""}),f=E({tenantName:"",mobile:"",captchaVerification:"",scene:23}),p=c(0),D=c(""),G=async()=>{s.captchaEnable==="false"?await v({}):y.value.show()},v=async i=>{s.tenantEnable==="true"&&await k(),f.captchaVerification=i.captchaVerification,f.mobile=s.mobile,await re(f).then(async()=>{g.success(o("login.SmsSendMsg")),p.value=60;let l=setInterval(()=>{p.value=p.value-1,p.value<=0&&clearInterval(l)},1e3)})};$(()=>T.value,i=>{var l;D.value=(l=i==null?void 0:i.query)==null?void 0:l.redirect},{immediate:!0});const k=async()=>{if(s.tenantEnable==="true"){const i=await ie(s.tenantName);if(i==null)throw g.error(o("login.invalidTenantName")),o("login.invalidTenantName");de(i)}};return(i,l)=>{const n=se,d=te,h=oe,H=ge,V=le,N=ye,P=ue,J=ne;return ee((m(),C(J,{ref_key:"formSmsResetPassword",ref:b,model:e(s),rules:B,class:"login-form","label-position":"top","label-width":"120px",size:"large"},{default:t(()=>[a(V,{style:{"margin-right":"-10px","margin-left":"-10px"}},{default:t(()=>[a(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:t(()=>[a(n,null,{default:t(()=>[a(he,{style:{width:"100%"}})]),_:1})]),_:1}),a(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:t(()=>[e(s).tenantEnable==="true"?(m(),C(n,{key:0,prop:"tenantName"},{default:t(()=>[a(h,{modelValue:e(s).tenantName,"onUpdate:modelValue":l[0]||(l[0]=r=>e(s).tenantName=r),placeholder:e(o)("login.tenantNamePlaceholder"),"prefix-icon":e(I),type:"primary",link:""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})):_("",!0)]),_:1}),a(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:t(()=>[a(n,{prop:"mobile"},{default:t(()=>[a(h,{modelValue:e(s).mobile,"onUpdate:modelValue":l[1]||(l[1]=r=>e(s).mobile=r),placeholder:e(o)("login.mobileNumberPlaceholder"),"prefix-icon":e(U)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),a(H,{ref_key:"verify",ref:y,captchaType:e(A),imgSize:{width:"400px",height:"200px"},mode:"pop",onSuccess:v},null,8,["captchaType"]),a(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:t(()=>[a(n,{prop:"code"},{default:t(()=>[a(V,{gutter:5,justify:"space-between",style:{width:"100%"}},{default:t(()=>[a(d,{span:24},{default:t(()=>[a(h,{modelValue:e(s).code,"onUpdate:modelValue":l[2]||(l[2]=r=>e(s).code=r),placeholder:e(o)("login.codePlaceholder"),"prefix-icon":e(z)},{append:t(()=>[e(p)<=0?(m(),q("span",{key:0,class:"getMobileCode",style:{cursor:"pointer"},onClick:G},F(e(o)("login.getSmsCode")),1)):_("",!0),e(p)>0?(m(),q("span",be,F(e(p))+"\u79D2\u540E\u53EF\u91CD\u65B0\u83B7\u53D6 ",1)):_("",!0)]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1})]),_:1})]),_:1}),a(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:t(()=>[a(n,{prop:"password"},{default:t(()=>[a(N,{modelValue:e(s).password,"onUpdate:modelValue":l[3]||(l[3]=r=>e(s).password=r),placeholder:e(o)("login.passwordPlaceholder"),style:{width:"100%"},strength:"true"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),a(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:t(()=>[a(n,{prop:"check_password"},{default:t(()=>[a(N,{modelValue:e(s).check_password,"onUpdate:modelValue":l[4]||(l[4]=r=>e(s).check_password=r),placeholder:e(o)("login.checkPassword"),style:{width:"100%"},strength:"true"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),a(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:t(()=>[a(n,null,{default:t(()=>[a(P,{loading:e(u),title:e(o)("login.resetPassword"),class:"w-[100%]",type:"primary",onClick:l[5]||(l[5]=r=>(async()=>{await R()&&(await k(),u.value=!0,await pe(s).then(async()=>{g.success(o("login.resetPasswordSuccess")),j(L.LOGIN)}).catch(()=>{}).finally(()=>{u.value=!1,setTimeout(()=>{ce.service().close()},400)}))})())},null,8,["loading","title"])]),_:1})]),_:1}),a(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:t(()=>[a(n,null,{default:t(()=>[a(P,{loading:e(u),title:e(o)("login.backLogin"),class:"w-[100%]",onClick:l[6]||(l[6]=r=>e(M)())},null,8,["loading","title"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[ae,e(W)]])}}}),[["__scopeId","data-v-7bcea1b4"]]);export{xe as default};
