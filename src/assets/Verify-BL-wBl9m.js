import{b1 as q,q as Q,b2 as Z,b3 as le,r as t,a4 as J,h as ne,as as ue,b as se,c as O,o as T,v as A,f as n,a as e,n as x,a5 as ee,j as pe,ae as te,s as he,A as F,t as V,T as ve,aG as oe,b4 as re,F as de,i as ge,_ as fe,w as ye,x as me,C as be,b5 as Se}from"./index-Cv_H95TD.js";function G(i,v="XwKsGlMcdPMEhR1B"){const l=q.enc.Utf8.parse(v),o=q.enc.Utf8.parse(i);return q.AES.encrypt(o,l,{mode:q.mode.ECB,padding:q.pad.Pkcs7}).toString()}function ce(i){let v,l,o,y;const s=window,c=i.$el.parentNode.offsetWidth||s.offsetWidth,f=i.$el.parentNode.offsetHeight||s.offsetHeight;return v=i.imgSize.width.indexOf("%")!=-1?parseInt(i.imgSize.width)/100*c+"px":i.imgSize.width,l=i.imgSize.height.indexOf("%")!=-1?parseInt(i.imgSize.height)/100*f+"px":i.imgSize.height,o=i.barSize.width.indexOf("%")!=-1?parseInt(i.barSize.width)/100*c+"px":i.barSize.width,y=i.barSize.height.indexOf("%")!=-1?parseInt(i.barSize.height)/100*f+"px":i.barSize.height,{imgWidth:v,imgHeight:l,barWidth:o,barHeight:y}}const xe={style:{position:"relative"}},we=["src"],ze=["textContent"],ke=["textContent"],We=["src"],Te={style:{position:"relative"}},He={class:"verify-img-out"},$e=["src"],Oe={class:"verify-msg"},Ie={key:0,class:"verifybox-top"},Ne=fe({name:"Vue3Verify",components:{VerifySlide:{__name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:""},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object,default:()=>({width:"50px",height:"50px"})},barSize:{type:Object,default:()=>({width:"310px",height:"30px"})}},setup(i){const v=i,{t:l}=Q(),{mode:o,captchaType:y,type:s,blockSize:c,explain:f}=Z(v),{proxy:u}=le();let p=t(""),w=t(""),U=t(""),L=t(""),g=t(""),C=t(""),E=t(""),z=t(""),k=t(""),_=t(""),r=J({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),H=t(void 0),I=t(void 0),N=t(void 0),$=t("#ddd"),B=t(void 0),m=t("icon-right"),h=t(!1),d=t(!1),b=t(!0),M=t(""),P=t(""),X=t(0);const j=ne(()=>u.$el.querySelector(".verify-bar-area")),ie=()=>{f.value===""?k.value=l("captcha.slide"):k.value=f.value,oe(()=>{let{imgHeight:a,imgWidth:S,barHeight:W,barWidth:Y}=ce(u);r.imgHeight=a,r.imgWidth=S,r.barHeight=W,r.barWidth=Y,u.$parent.$emit("ready",u)}),window.removeEventListener("touchmove",function(a){R(a)}),window.removeEventListener("mousemove",function(a){R(a)}),window.removeEventListener("touchend",function(){D()}),window.removeEventListener("mouseup",function(){D()}),window.addEventListener("touchmove",function(a){R(a)}),window.addEventListener("mousemove",function(a){R(a)}),window.addEventListener("touchend",function(){D()}),window.addEventListener("mouseup",function(){D()})};ue(s,()=>{ie()}),se(()=>{ie(),u.$el.onselectstart=function(){return!1}});const ae=a=>{if((a=a||window.event).touches)S=a.touches[0].pageX;else var S=a.clientX;X.value=Math.floor(S-j.value.getBoundingClientRect().left),C.value=+new Date,d.value==0&&(k.value="",N.value="#337ab7",$.value="#337AB7",B.value="#fff",a.stopPropagation(),h.value=!0)},R=a=>{if(a=a||window.event,h.value&&d.value==0){if(a.touches)S=a.touches[0].pageX;else var S=a.clientX;var W=S-j.value.getBoundingClientRect().left;W>=j.value.offsetWidth-parseInt(parseInt(c.value.width)/2)-2&&(W=j.value.offsetWidth-parseInt(parseInt(c.value.width)/2)-2),W<=0&&(W=parseInt(parseInt(c.value.width)/2)),H.value=W-X.value+"px",I.value=W-X.value+"px"}},D=()=>{if(E.value=+new Date,h.value&&d.value==0){var a=parseInt((H.value||"0").replace("px",""));a=310*a/parseInt(r.imgWidth);let S={captchaType:y.value,pointJson:p.value?G(JSON.stringify({x:a,y:5}),p.value):JSON.stringify({x:a,y:5}),token:g.value};re(S).then(W=>{if(W.repCode=="0000"){N.value="#5cb85c",$.value="#5cb85c",B.value="#fff",m.value="icon-check",b.value=!1,d.value=!0,o.value=="pop"&&setTimeout(()=>{u.$parent.clickShow=!1,K()},1500),w.value=!0,z.value=`${((E.value-C.value)/1e3).toFixed(2)}s
            ${l("captcha.success")}`;var Y=p.value?G(g.value+"---"+JSON.stringify({x:a,y:5}),p.value):g.value+"---"+JSON.stringify({x:a,y:5});setTimeout(()=>{z.value="",u.$parent.closeBox(),u.$parent.$emit("success",{captchaVerification:Y})},1e3)}else N.value="#d9534f",$.value="#d9534f",B.value="#fff",m.value="icon-close",w.value=!1,setTimeout(function(){K()},1e3),u.$parent.$emit("error",u),z.value=l("captcha.fail"),setTimeout(()=>{z.value=""},1e3)}),h.value=!1}},K=async()=>{b.value=!0,_.value="",M.value="left .3s",H.value=0,I.value=void 0,P.value="width .3s",$.value="#ddd",N.value="#fff",B.value="#000",m.value="icon-right",d.value=!1,setTimeout(()=>{P.value="",M.value="",k.value=f.value},300)};return(a,S)=>(T(),O("div",xe,[e(s)==="2"?(T(),O("div",{key:0,style:x({height:parseInt(e(r).imgHeight)+i.vSpace+"px"}),class:"verify-img-out"},[n("div",{style:x({width:e(r).imgWidth,height:e(r).imgHeight}),class:"verify-img-panel"},[n("img",{src:"data:image/png;base64,"+e(U),alt:"",style:{display:"block",width:"100%",height:"100%"}},null,8,we),ee(n("div",{class:"verify-refresh",onClick:K},S[0]||(S[0]=[n("i",{class:"iconfont icon-refresh"},null,-1)]),512),[[te,e(b)]]),pe(ve,{name:"tips"},{default:he(()=>[e(z)?(T(),O("span",{key:0,class:F([e(w)?"suc-bg":"err-bg","verify-tips"])},V(e(z)),3)):A("",!0)]),_:1})],4)],4)):A("",!0),n("div",{style:x({width:e(r).imgWidth,height:i.barSize.height,"line-height":i.barSize.height}),class:"verify-bar-area"},[n("span",{class:"verify-msg",textContent:V(e(k))},null,8,ze),n("div",{style:x({width:e(I)!==void 0?e(I):i.barSize.height,height:i.barSize.height,"border-color":e($),transaction:e(P)}),class:"verify-left-bar"},[n("span",{class:"verify-msg",textContent:V(e(_))},null,8,ke),n("div",{style:x({width:i.barSize.height,height:i.barSize.height,"background-color":e(N),left:e(H),transition:e(M)}),class:"verify-move-block",onMousedown:ae,onTouchstart:ae},[n("i",{class:F(["verify-icon iconfont",e(m)]),style:x({color:e(B)})},null,6),e(s)==="2"?(T(),O("div",{key:0,style:x({width:Math.floor(47*parseInt(e(r).imgWidth)/310)+"px",height:e(r).imgHeight,top:"-"+(parseInt(e(r).imgHeight)+i.vSpace)+"px","background-size":e(r).imgWidth+" "+e(r).imgHeight}),class:"verify-sub-block"},[n("img",{src:"data:image/png;base64,"+e(L),alt:"",style:{display:"block",width:"100%",height:"100%","-webkit-user-drag":"none"}},null,8,We)],4)):A("",!0)],36)],4)],4)]))}},VerifyPoints:{__name:"VerifyPoints",props:{mode:{type:String,default:"fixed"},captchaType:{type:String},vSpace:{type:Number,default:5},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(i){const v=i,{t:l}=Q(),{mode:o,captchaType:y}=Z(v),{proxy:s}=le();let c=t(""),f=t(3),u=J([]),p=J([]),w=t(1),U=t("");J([]);let L=t(""),g=J({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),C=J([]),E=t(""),z=t(void 0),k=t(void 0),_=t(!0),r=t(!0);se(()=>{u.splice(0,u.length),p.splice(0,p.length),w.value=1,oe(()=>{let{imgHeight:m,imgWidth:h,barHeight:d,barWidth:b}=ce(s);g.imgHeight=m,g.imgWidth=h,g.barHeight=d,g.barWidth=b,s.$parent.$emit("ready",s)}),s.$el.onselectstart=function(){return!1}});const H=t(null),I=function(m,h){return{x:h.offsetX,y:h.offsetY}},N=function(m){return C.push(Object.assign({},m)),w.value+1},$=async function(){C.splice(0,C.length),z.value="#000",k.value="#ddd",r.value=!0,u.splice(0,u.length),p.splice(0,p.length),w.value=1,_.value=!0},B=function(m,h){return m.map(d=>({x:Math.round(310*d.x/parseInt(h.imgWidth)),y:Math.round(155*d.y/parseInt(h.imgHeight))}))};return(m,h)=>(T(),O("div",Te,[n("div",He,[n("div",{style:x({width:e(g).imgWidth,height:e(g).imgHeight,"background-size":e(g).imgWidth+" "+e(g).imgHeight,"margin-bottom":i.vSpace+"px"}),class:"verify-img-panel"},[ee(n("div",{class:"verify-refresh",style:{"z-index":"3"},onClick:$},h[1]||(h[1]=[n("i",{class:"iconfont icon-refresh"},null,-1)]),512),[[te,e(_)]]),n("img",{ref_key:"canvas",ref:H,src:"data:image/png;base64,"+e(U),alt:"",style:{display:"block",width:"100%",height:"100%"},onClick:h[0]||(h[0]=d=>e(r)?(b=>{if(p.push(I(H,b)),w.value==f.value){w.value=N(I(H,b));let M=B(p,g);p.length=0,p.push(...M),setTimeout(()=>{var P=c.value?G(L.value+"---"+JSON.stringify(p),c.value):L.value+"---"+JSON.stringify(p);let X={captchaType:y.value,pointJson:c.value?G(JSON.stringify(p),c.value):JSON.stringify(p),token:L.value};re(X).then(j=>{j.repCode=="0000"?(z.value="#4cae4c",k.value="#5cb85c",E.value=l("captcha.success"),r.value=!1,o.value=="pop"&&setTimeout(()=>{s.$parent.clickShow=!1,$()},1500),s.$parent.$emit("success",{captchaVerification:P})):(s.$parent.$emit("error",s),z.value="#d9534f",k.value="#d9534f",E.value=l("captcha.fail"),setTimeout(()=>{$()},700))})},400)}w.value<f.value&&(w.value=N(I(H,b)))})(d):void 0)},null,8,$e),(T(!0),O(de,null,ge(e(C),(d,b)=>(T(),O("div",{key:b,style:x({"background-color":"#1abd6c",color:"#fff","z-index":9999,width:"20px",height:"20px","text-align":"center","line-height":"20px","border-radius":"50%",position:"absolute",top:parseInt(d.y-10)+"px",left:parseInt(d.x-10)+"px"}),class:"point-area"},V(b+1),5))),128))],4)]),n("div",{style:x({width:e(g).imgWidth,color:e(z),"border-color":e(k),"line-height":i.barSize.height}),class:"verify-bar-area"},[n("span",Oe,V(e(E)),1)],4)]))}}},props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object},barSize:{type:Object}},setup(i){const{t:v}=Q(),{captchaType:l,mode:o}=Z(i),y=t(!1),s=t(void 0),c=t(void 0),f=t({}),u=ne(()=>o.value!="pop"||y.value);return ye(()=>{switch(l.value){case"blockPuzzle":s.value="2",c.value="VerifySlide";break;case"clickWord":s.value="",c.value="VerifyPoints"}}),{t:v,clickShow:y,verifyType:s,componentType:c,instance:f,showBox:u,closeBox:()=>{y.value=!1,f.value.refresh&&f.value.refresh()},show:()=>{o.value=="pop"&&(y.value=!0)}}}},[["render",function(i,v,l,o,y,s){return ee((T(),O("div",{class:F(l.mode=="pop"?"mask":"")},[n("div",{class:F(l.mode=="pop"?"verifybox":""),style:x({"max-width":parseInt(l.imgSize.width)+20+"px"})},[l.mode=="pop"?(T(),O("div",Ie,[me(V(o.t("captcha.verification"))+" ",1),n("span",{class:"verifybox-close",onClick:v[0]||(v[0]=(...c)=>o.closeBox&&o.closeBox(...c))},v[1]||(v[1]=[n("i",{class:"iconfont icon-close"},null,-1)]))])):A("",!0),n("div",{style:x({padding:l.mode=="pop"?"10px":"0"}),class:"verifybox-bottom"},[o.componentType?(T(),be(Se(o.componentType),{key:0,ref:"instance",arith:l.arith,barSize:l.barSize,blockSize:l.blockSize,captchaType:l.captchaType,explain:l.explain,figure:l.figure,imgSize:l.imgSize,mode:l.mode,type:o.verifyType,vSpace:l.vSpace},null,8,["arith","barSize","blockSize","captchaType","explain","figure","imgSize","mode","type","vSpace"])):A("",!0)],4)],6)],2)),[[te,o.showBox]])}]]);export{Ne as _};
