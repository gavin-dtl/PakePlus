import{d as k,r as t,as as F,h as c,b as $,e as A,Y as E,c as f,o as y,v as O,f as d,n as h,a as b,at as j,_ as N}from"./index-Cv_H95TD.js";import{S as B}from"./index-CT5T1-Ok.js";import{e as w}from"./mitt-CI7Qv1RY.js";const D={class:"content"},J=["src"],P={class:"cylinder-container"},Y=N(k({__name:"index",props:{params:{type:Object,default:()=>({})},interval:{type:Number,default:0},immediate:{type:Boolean,default:!0}},emits:["update","error"],setup(I,{expose:_,emit:q}){const r=I,m=q,l=t(""),v=t(!1),i=t("");t(null);const n=async()=>{try{v.value=!0,i.value="";const a=await B.getPic(r.params);if(!a)throw new Error("\u65E0\u6548\u7684\u56FE\u7247\u6570\u636E");l.value=a.img,m("update",a.data)}catch(a){i.value=a.message||"\u83B7\u53D6\u56FE\u7247\u5931\u8D25",m("error",a),j.error(i.value)}finally{v.value=!1}},x=t(""),u=t([]);F(()=>r.params,()=>{n()},{deep:!0});const p=t(-60),o=c(()=>(p.value+60)/60*100),R=c(()=>({width:"7px",height:"70%",background:"linear-gradient(to top, rgb(0, 150, 50), rgb(150, 0, 50))"})),S=c(()=>({height:`${o.value}%`,background:`linear-gradient(to top,#00FF00,rgb(${255*o.value/100},${255-o.value/100*255},0)`})),g=a=>{var e;const s=JSON.parse(a.message)[(e=r.params)==null?void 0:e.name];p.value=s?s.cntDb:-60};return $(()=>{w.on("AudioStatus",g),r.immediate&&((a,s)=>{const e={timerId:null,interval:a,requestFn:s,isRequesting:!1};e.timerId=window.setInterval(async()=>{if(!e.isRequesting){e.isRequesting=!0;try{await s()}catch{}finally{e.isRequesting=!1}}},a),u.value.push(e)})(r.interval||"1000",()=>n())}),A(()=>{w.off("AudioStatus",g)}),E(()=>{u.value.forEach(a=>{a.timerId&&clearInterval(a.timerId)}),u.value=[],x.value="\u6240\u6709\u8F6E\u8BE2\u5DF2\u505C\u6B62"}),_({refresh:n}),(a,s)=>(y(),f("div",D,[l.value?(y(),f("img",{key:0,src:l.value,class:"polling-image",alt:"\u8F6E\u8BE2\u56FE\u7247"},null,8,J)):O("",!0),d("div",P,[d("div",{class:"cylinder",style:h(b(R))},[d("div",{class:"fill",style:h(b(S))},null,4)],4)])]))}}),[["__scopeId","data-v-57f42446"]]);export{Y as _};
