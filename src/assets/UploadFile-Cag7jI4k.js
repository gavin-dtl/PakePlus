import{au as u,d as I,ar as t,p as j,r as n,as as T,c as L,v as $,o as k,j as m,aV as q,a as D,ap as M,s as c,H as P,x as R,t as A,aW as f,_ as B}from"./index-DzCoMBOl.js";const b={commonFileList:async l=>await u.get({url:"/core/file/commonFileList",params:l}),createDirectory:async l=>await u.get({url:"/core/file/createDirectory",params:l}),uploadFile:async l=>await u.upload({url:"/core/file/upload",data:l}),deleteFile:async l=>await u.get({url:"/core/file/delete",params:l})},H={key:0,class:"upload-file"},v=B(I({name:"UploadFile",__name:"UploadFile",props:{modelValue:t.oneOfType([String,Array]).isRequired,fileType:t.array.def([]),fileSize:t.number.def(1024),limit:t.number.def(5),autoUpload:t.bool.def(!0),drag:t.bool.def(!1),isShowTip:t.bool.def(!0),disabled:t.bool.def(!1),title:t.string.def("\u9009\u53D6\u6587\u4EF6"),dir:{type:String,default:""}},emits:["update:modelValue","uploadSuccess"],setup(l,{emit:y}){const d=j(),p=y,s=l,g=n();n([]);const i=n([]),_=n(0),S=e=>{if(i.value.length>=s.limit)return d.error(`\u4E0A\u4F20\u6587\u4EF6\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC7${s.limit}\u4E2A!`),!1;if(e.name.lastIndexOf(".")>-1&&e.name.slice(e.name.lastIndexOf(".")+1),!(e.size<1024*s.fileSize*1024))return d.error(`\u4E0A\u4F20\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7${s.fileSize}MB!`),!1;d.success("\u6B63\u5728\u4E0A\u4F20\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019..."),_.value++},h=e=>{d.success("\u4E0A\u4F20\u6210\u529F"),i.value=[],p("uploadSuccess")},x=()=>{d.error(`\u4E0A\u4F20\u6587\u4EF6\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC7${s.limit}\u4E2A!`)},w=()=>{},F=e=>{const a=i.value.map(r=>r.name).indexOf(e.name);a>-1&&(i.value.splice(a,1),V())},O=e=>{},U=e=>new Promise((a,r)=>{b.uploadFile({file:e.file,dir:s.dir}).then(o=>{o.code===0?a(o):r(o)}).catch(o=>{r(o)})});T(()=>s.modelValue,e=>{e?(i.value=[],f(e)?i.value.push(...e.split(",").map(a=>({name:a.substring(a.lastIndexOf("/")+1),url:a}))):i.value.push(...e.map(a=>({name:a.substring(a.lastIndexOf("/")+1),url:a})))):i.value=[]},{immediate:!0,deep:!0});const V=()=>{let e=i.value.map(a=>a.url);(s.limit===1||f(s.modelValue))&&(e=e.join(",")),p("update:modelValue",e)};return(e,a)=>{const r=P,o=q;return l.disabled?$("",!0):(k(),L("div",H,[m(o,{ref_key:"uploadRef",ref:g,"file-list":D(i),"onUpdate:fileList":a[0]||(a[0]=z=>M(i)?i.value=z:null),action:"/api/core/file/upload","auto-upload":l.autoUpload,"before-upload":S,disabled:l.disabled,drag:l.drag,"http-request":U,limit:s.limit,multiple:s.limit>1,"on-error":w,"on-exceed":x,"on-preview":O,"on-remove":F,"on-success":h,"show-file-list":!1,class:"upload-file-uploader",name:"file"},{default:c(()=>[m(r,{type:"primary"},{default:c(()=>[R(A(l.title),1)]),_:1})]),_:1},8,["file-list","auto-upload","disabled","drag","limit","multiple"])]))}}}),[["__scopeId","data-v-83dacc13"]]),W=Object.freeze(Object.defineProperty({__proto__:null,default:v},Symbol.toStringTag,{value:"Module"}));export{b as F,v as U,W as a};
