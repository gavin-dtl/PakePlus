import{d as O,l as j,k as A,r as u,b as B,e as G,c as g,o as r,f as m,m as t,z as k,p as P,w as n,q as C,C as J,aE as K,a as o,ao as Q,F as W,y as X,t as F,O as v,aS as Z,H as $,aT as aa,aU as ea,aR as la,_ as ta}from"./index-h2IMwmcw.js";import{U as sa,F as w}from"./UploadFile-CVp29_BB.js";const na={class:"f1le-main"},ia={class:"operate-button"},ra={class:"filePath"},oa=["onClick"],pa={style:{"background-color":"rgba(35,110,214,0.26)","border-radius":"4px",padding:"5px 10px","margin-left":"5px"}},ca={key:0},da={style:{"margin-top":"15px"}},ua={style:{"margin-left":"5px"}},ma=O({name:"FileManagement",__name:"index",emits:["success"],setup(ya,{emit:ha}){const{t:U}=j(),s=A(),p=(u({}),u([])),z=u([]),i=async e=>{const a=await w.commonFileList({path:e});p.value=a.filePath,z.value=a.fileList,c.value=p.value[p.value.length-1].path},V=async e=>{e.directory&&i(e.path)},R=async()=>{const e=await s.validatePrompt("\u8BF7\u8F93\u5165\u6587\u4EF6\u5939\u540D\u79F0",U("\u521B\u5EFA\u6587\u4EF6\u5939"),{inputValue:"",validator:d=>!!d||"\u6587\u4EF6\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}),a=p.value[p.value.length-1].path;await w.createDirectory({dirName:e.value,basePath:a}),i(a),s.success("\u65B0\u589E\u6210\u529F")},x=u(),c=u(""),T={title:"\u6587\u4EF6\u4E0A\u4F20",isShowTip:!1},Y=()=>{i(c.value)},_=u([]),E=e=>{_.value=e},I=async()=>{try{await s.delConfirm(),await Promise.all(_.value.map(e=>w.deleteFile({filePath:e.path}))),await i(c.value)}catch{}},b=u(!1),L=e=>{e.preventDefault(),b.value=!0},N=e=>{e.preventDefault(),b.value=!1},q=async e=>{e.preventDefault(),b.value=!1;const a=e.dataTransfer.files;if(a&&a.length!==0)if(a.length>1)s.error("\u5355\u6B21\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6");else if(a[0].size!==0||a[0].type!==""){s.success("\u6B63\u5728\u4E0A\u4F20\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019...");try{await w.uploadFile({file:a[0],dir:c.value}),s.success("\u6587\u4EF6\u4E0A\u4F20\u6210\u529F"),i(c.value)}catch{s.error("\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25")}}else s.error("\u6682\u4E0D\u652F\u6301\u4E0A\u4F20\u6587\u4EF6\u5939")};return B(()=>{i("")}),G(()=>{}),(e,a)=>{const d=J,f=Z,H=$,M=la;return r(),g("div",na,[m("div",ia,[t(d,{type:"primary",onClick:R},{default:n(()=>a[1]||(a[1]=[C("\u521B\u5EFA\u6587\u4EF6\u5939")])),_:1}),t(sa,K({style:{display:"inline-block","margin-left":"10px",transform:"translateY(4px)"},onUploadSuccess:Y},T,{dir:o(c),modelValue:o(x),"onUpdate:modelValue":a[0]||(a[0]=l=>Q(x)?x.value=l:null),limit:1}),null,16,["dir","modelValue"]),o(_).length>0?(r(),k(d,{key:0,type:"danger",onClick:I,style:{"margin-left":"10px",transform:"translateY(2px)"}},{default:n(()=>a[2]||(a[2]=[C("\u6279\u91CF\u5220\u9664")])),_:1})):P("",!0)]),m("div",ra,[(r(!0),g(W,null,X(o(p),(l,D)=>(r(),g("p",{onClick:y=>{i(l.path)},key:l.path},[m("span",pa,F(l.name),1),o(p).length!=D+1?(r(),g("span",ca," > ")):P("",!0)],8,oa))),128))]),m("div",da,[m("div",{class:"file-drop-area",onDrop:v(q,["prevent"]),onDragover:v(L,["prevent"]),onDragleave:v(N,["prevent"])},[t(M,{data:o(z),height:"660px",style:{width:"100%"},onCellClick:V,onSelectionChange:E},{default:n(()=>[t(f,{type:"selection",width:"55"}),t(f,{prop:"name",label:"\u540D\u79F0"},{default:n(l=>[t(H,null,{default:n(()=>[l.row.directory?(r(),k(o(aa),{key:0})):(r(),k(o(ea),{key:1}))]),_:2},1024),m("span",ua,F(l.row.name),1)]),_:1}),t(f,{prop:"size",label:"\u5927\u5C0F",width:"250px",align:"center"}),t(f,{prop:"format",label:"\u7C7B\u578B",width:"250px",align:"center"},{default:n(l=>[m("span",null,F(l.row.directory?"\u6587\u4EF6\u5939":l.row.format),1)]),_:1}),t(f,{label:"\u64CD\u4F5C",align:"center",width:"250px"},{default:n(l=>[t(d,{size:"small",type:"danger",onClick:v(D=>(async y=>{await s.delConfirm("\u786E\u8BA4\u5220\u9664\u6587\u4EF6?"),await w.deleteFile({filePath:y.path}),i(c.value)})(l.row),["stop"])},{default:n(()=>a[3]||(a[3]=[C(" \u5220\u9664 ")])),_:2},1032,["onClick"]),l.row.directory?P("",!0):(r(),k(d,{key:0,size:"small",onClick:v(D=>(async y=>{try{const S="/api/core/file/download?filePath="+encodeURIComponent(y.path),h=document.createElement("a");h.href=S,h.download=y.playName,document.body.appendChild(h),h.click(),document.body.removeChild(h)}catch{}})(l.row),["stop"])},{default:n(()=>a[4]||(a[4]=[C(" \u4E0B\u8F7D ")])),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])],32)])])}}}),fa=ta(ma,[["__scopeId","data-v-c94872f2"]]);export{fa as default};
