import{at as u,d as I,aq as s,k as q,r as n,ar as T,c as j,p as k,o as L,m,aV as $,a as D,ao as M,w as c,C as P,q as R,t as A,aW as f,_ as B}from"./index-h2IMwmcw.js";const b={commonFileList:async l=>await u.get({url:"/core/file/commonFileList",params:l}),createDirectory:async l=>await u.get({url:"/core/file/createDirectory",params:l}),uploadFile:async l=>await u.upload({url:"/core/file/upload",data:l}),deleteFile:async l=>await u.get({url:"/core/file/delete",params:l})},C={key:0,class:"upload-file"},y=B(I({name:"UploadFile",__name:"UploadFile",props:{modelValue:s.oneOfType([String,Array]).isRequired,fileType:s.array.def([]),fileSize:s.number.def(1024),limit:s.number.def(5),autoUpload:s.bool.def(!0),drag:s.bool.def(!1),isShowTip:s.bool.def(!0),disabled:s.bool.def(!1),title:s.string.def("\u9009\u53D6\u6587\u4EF6"),dir:{type:String,default:""}},emits:["update:modelValue","uploadSuccess"],setup(l,{emit:g}){const d=q(),p=g,t=l,v=n();n([]);const i=n([]),_=n(0),w=e=>{if(i.value.length>=t.limit)return d.error(`\u4E0A\u4F20\u6587\u4EF6\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC7${t.limit}\u4E2A!`),!1;if(e.name.lastIndexOf(".")>-1&&e.name.slice(e.name.lastIndexOf(".")+1),!(e.size<1024*t.fileSize*1024))return d.error(`\u4E0A\u4F20\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7${t.fileSize}MB!`),!1;d.success("\u6B63\u5728\u4E0A\u4F20\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019..."),_.value++},S=e=>{d.success("\u4E0A\u4F20\u6210\u529F"),i.value=[],p("uploadSuccess")},h=()=>{d.error(`\u4E0A\u4F20\u6587\u4EF6\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC7${t.limit}\u4E2A!`)},F=()=>{},O=e=>{const a=i.value.map(r=>r.name).indexOf(e.name);a>-1&&(i.value.splice(a,1),V())},x=e=>{},U=e=>new Promise((a,r)=>{b.uploadFile({file:e.file,dir:t.dir}).then(o=>{o.code===0?a(o):r(o)}).catch(o=>{r(o)})});T(()=>t.modelValue,e=>{e?(i.value=[],f(e)?i.value.push(...e.split(",").map(a=>({name:a.substring(a.lastIndexOf("/")+1),url:a}))):i.value.push(...e.map(a=>({name:a.substring(a.lastIndexOf("/")+1),url:a})))):i.value=[]},{immediate:!0,deep:!0});const V=()=>{let e=i.value.map(a=>a.url);(t.limit===1||f(t.modelValue))&&(e=e.join(",")),p("update:modelValue",e)};return(e,a)=>{const r=P,o=$;return l.disabled?k("",!0):(L(),j("div",C,[m(o,{ref_key:"uploadRef",ref:v,"file-list":D(i),"onUpdate:fileList":a[0]||(a[0]=z=>M(i)?i.value=z:null),action:"/api/core/file/upload","auto-upload":l.autoUpload,"before-upload":w,disabled:l.disabled,drag:l.drag,"http-request":U,limit:t.limit,multiple:t.limit>1,"on-error":F,"on-exceed":h,"on-preview":x,"on-remove":O,"on-success":S,"show-file-list":!1,class:"upload-file-uploader",name:"file"},{default:c(()=>[m(r,{type:"primary"},{default:c(()=>[R(A(l.title),1)]),_:1})]),_:1},8,["file-list","auto-upload","disabled","drag","limit","multiple"])]))}}}),[["__scopeId","data-v-83dacc13"]]),W=Object.freeze(Object.defineProperty({__proto__:null,default:y},Symbol.toStringTag,{value:"Module"}));export{b as F,y as U,W as a};
